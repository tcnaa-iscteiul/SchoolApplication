{"ast":null,"code":"import axios from 'axios';\nimport { getCookie, setCookie } from 'typescript-cookie';\nimport Config from '../util/Config';\nconst api = axios.create({\n  baseURL: `${Config.API_URL}`,\n  headers: {\n    Accept: 'application/json',\n    Authorization: `Bearer ${getCookie('token')}`\n  }\n}); // For GET requests\n\napi.interceptors.request.use(config => {\n  // Add configurations here\n  if (config.headers) {\n    config.headers.Authorization = `Bearer ${getCookie('token')}`;\n    return config;\n  }\n}, err => Promise.reject(err)); // For POST requests\n\napi.interceptors.response.use(response => response, err => new Promise((resolve, reject) => {\n  const originalReq = err.config;\n\n  if (err.response.status === 401 && err.config && !err.config._retry) {\n    originalReq._retry = true;\n    const token = getCookie('token');\n\n    if (token) {\n      if (originalReq.headers) {\n        originalReq.headers.Authorization = `Bearer ${getCookie('token')}`;\n      }\n\n      const res = api.put(`${Config.API_URL}token/refresh`, {\n        oldToken: token\n      }).then(res => {\n        setCookie('token', res.data.accessToken);\n        originalReq.headers.Authorization = `Bearer ${res.data.accessToken}`;\n        return axios(originalReq);\n      });\n      resolve(res);\n    } else {\n      reject(err);\n    }\n  }\n\n  if (err.response.status === 408 || err.code === 'ECONNABORTED') {\n    return Promise.reject(err);\n  }\n\n  reject(err);\n}));\nexport default api;","map":{"version":3,"names":["axios","getCookie","setCookie","Config","api","create","baseURL","API_URL","headers","Accept","Authorization","interceptors","request","use","config","err","Promise","reject","response","resolve","originalReq","status","_retry","token","res","put","oldToken","then","data","accessToken","code"],"sources":["C:/Users/Utilizador/OneDrive/Ambiente de Trabalho/SchoolApplication/frontend/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\r\nimport { getCookie, setCookie } from 'typescript-cookie';\r\nimport Config from '../util/Config';\r\n\r\nconst api = axios.create({\r\n  baseURL: `${Config.API_URL}`,\r\n  headers: {\r\n    Accept: 'application/json',\r\n    Authorization: `Bearer ${getCookie('token')}`,\r\n  },\r\n});\r\n\r\n// For GET requests\r\napi.interceptors.request.use(\r\n  (config) => {\r\n    // Add configurations here\r\n    if (config.headers) {\r\n      config.headers.Authorization = `Bearer ${getCookie('token')}`;\r\n      return config;\r\n    }\r\n  },\r\n  (err) => Promise.reject(err),\r\n);\r\n\r\n// For POST requests\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (err) =>\r\n    new Promise((resolve, reject) => {\r\n      const originalReq = err.config;\r\n      if (err.response.status === 401 && err.config && !err.config._retry) {\r\n        originalReq._retry = true;\r\n        const token = getCookie('token');\r\n        if (token) {\r\n          if (originalReq.headers) {\r\n            originalReq.headers.Authorization = `Bearer ${getCookie('token')}`;\r\n          }\r\n          const res = api\r\n            .put(`${Config.API_URL}token/refresh`, { oldToken: token })\r\n            .then((res) => {\r\n              setCookie('token', res.data.accessToken);\r\n              originalReq.headers.Authorization = `Bearer ${res.data.accessToken}`;\r\n              return axios(originalReq);\r\n            });\r\n          resolve(res);\r\n        } else {\r\n          reject(err);\r\n        }\r\n      }\r\n      if (err.response.status === 408 || err.code === 'ECONNABORTED') {\r\n        return Promise.reject(err);\r\n      }\r\n      reject(err);\r\n    }),\r\n);\r\n\r\nexport default api;\r\n"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT,EAAoBC,SAApB,QAAqC,mBAArC;AACA,OAAOC,MAAP,MAAmB,gBAAnB;AAEA,MAAMC,GAAG,GAAGJ,KAAK,CAACK,MAAN,CAAa;EACvBC,OAAO,EAAG,GAAEH,MAAM,CAACI,OAAQ,EADJ;EAEvBC,OAAO,EAAE;IACPC,MAAM,EAAE,kBADD;IAEPC,aAAa,EAAG,UAAST,SAAS,CAAC,OAAD,CAAU;EAFrC;AAFc,CAAb,CAAZ,C,CAQA;;AACAG,GAAG,CAACO,YAAJ,CAAiBC,OAAjB,CAAyBC,GAAzB,CACGC,MAAD,IAAY;EACV;EACA,IAAIA,MAAM,CAACN,OAAX,EAAoB;IAClBM,MAAM,CAACN,OAAP,CAAeE,aAAf,GAAgC,UAAST,SAAS,CAAC,OAAD,CAAU,EAA5D;IACA,OAAOa,MAAP;EACD;AACF,CAPH,EAQGC,GAAD,IAASC,OAAO,CAACC,MAAR,CAAeF,GAAf,CARX,E,CAWA;;AACAX,GAAG,CAACO,YAAJ,CAAiBO,QAAjB,CAA0BL,GAA1B,CACGK,QAAD,IAAcA,QADhB,EAEGH,GAAD,IACE,IAAIC,OAAJ,CAAY,CAACG,OAAD,EAAUF,MAAV,KAAqB;EAC/B,MAAMG,WAAW,GAAGL,GAAG,CAACD,MAAxB;;EACA,IAAIC,GAAG,CAACG,QAAJ,CAAaG,MAAb,KAAwB,GAAxB,IAA+BN,GAAG,CAACD,MAAnC,IAA6C,CAACC,GAAG,CAACD,MAAJ,CAAWQ,MAA7D,EAAqE;IACnEF,WAAW,CAACE,MAAZ,GAAqB,IAArB;IACA,MAAMC,KAAK,GAAGtB,SAAS,CAAC,OAAD,CAAvB;;IACA,IAAIsB,KAAJ,EAAW;MACT,IAAIH,WAAW,CAACZ,OAAhB,EAAyB;QACvBY,WAAW,CAACZ,OAAZ,CAAoBE,aAApB,GAAqC,UAAST,SAAS,CAAC,OAAD,CAAU,EAAjE;MACD;;MACD,MAAMuB,GAAG,GAAGpB,GAAG,CACZqB,GADS,CACJ,GAAEtB,MAAM,CAACI,OAAQ,eADb,EAC6B;QAAEmB,QAAQ,EAAEH;MAAZ,CAD7B,EAETI,IAFS,CAEHH,GAAD,IAAS;QACbtB,SAAS,CAAC,OAAD,EAAUsB,GAAG,CAACI,IAAJ,CAASC,WAAnB,CAAT;QACAT,WAAW,CAACZ,OAAZ,CAAoBE,aAApB,GAAqC,UAASc,GAAG,CAACI,IAAJ,CAASC,WAAY,EAAnE;QACA,OAAO7B,KAAK,CAACoB,WAAD,CAAZ;MACD,CANS,CAAZ;MAOAD,OAAO,CAACK,GAAD,CAAP;IACD,CAZD,MAYO;MACLP,MAAM,CAACF,GAAD,CAAN;IACD;EACF;;EACD,IAAIA,GAAG,CAACG,QAAJ,CAAaG,MAAb,KAAwB,GAAxB,IAA+BN,GAAG,CAACe,IAAJ,KAAa,cAAhD,EAAgE;IAC9D,OAAOd,OAAO,CAACC,MAAR,CAAeF,GAAf,CAAP;EACD;;EACDE,MAAM,CAACF,GAAD,CAAN;AACD,CAzBD,CAHJ;AA+BA,eAAeX,GAAf"},"metadata":{},"sourceType":"module"}